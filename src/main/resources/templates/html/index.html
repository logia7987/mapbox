<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Mapbox</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.0/mapbox-gl.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
    <div id="map" style="width: 100%; height: 100vh"></div>
    <div id="sidebar">
        <div class="sidebar-menu">
            <a href="#" onclick="closeSidebar()" class="close-side sidebar-menu-list">&times;</a>
            <div class="file-upload sidebar-menu-list"> 파일 업로드 </div>
            <div class="mode-change-btn sidebar-menu-list" onclick="togglewhiteMode()"> 다크모드 전환 </div>
            <div class="etc sidebar-menu-list"> 기타 </div>


            <form id="frmFile">
                <input type="file" name="shpData" id="shpData">
            </form>
            <button onclick="uploadShpFile();">테스트 버튼</button>

        </div>
    </div>
    <div id="menu-btn" onclick="openSidebar()">&#9776;</div>
    <script th:inline="javascript">
        mapboxgl.accessToken = /*[[${mapboxAccessToken}]]*/ '';

        var lat,lng;

        const map = new mapboxgl.Map({
            container: "map",
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [126.88271541564299, 37.48151056694073],
            zoom: 11,
        });
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                lat = position.coords.latitude;
                lng = position.coords.longitude;

                map.setCenter([lng, lat]);

                const marker1 = new mapboxgl.Marker()
                    .setLngLat([lng, lat])
                    .addTo(map);
            });
        } else {
            const marker2 = new mapboxgl.Marker()
                .setLngLat([126.88271541564299, 37.48151056694073])
                .addTo(map);

            map.setCenter([126.88271541564299, 37.48151056694073]);
        }
        function openSidebar() {
            document.getElementById("sidebar").style.width = "250px";
            document.getElementById("map").style.marginright = "250px";
        }

        function closeSidebar() {
            document.getElementById("sidebar").style.width = "0";
            document.getElementById("map").style.marginright = "0";
        }

        function togglewhiteMode() {
            var sidebar = document.getElementById("sidebar");
            const menulist = document.querySelector(".sidebar-menu-list");

            const iswhiteMode = sidebar.classList.contains('white-mode');

            // Toggle between dark mode and light mode
            if (iswhiteMode) {
                sidebar.classList.remove('white-mode');
                menulist.classList.remove('white-mode');
            } else {
                sidebar.classList.add('white-mode');
                menulist.classList.add('white-mode');
            }
        }

        function uploadShpFile() {
            const frm = $("#frmFile")[0];
            let frmData = new FormData(frm);

            $.ajax({
                url : "api/uploadShp",
                type : "POST",
                data : frmData,
                contentType : false,
                processData: false,
                error: function() {
                    alert("error");
                }
            }).done(function (data) {
                console.log("===========성공============");
                console.log(data);
            });
        }

    </script>
</body>
</html>